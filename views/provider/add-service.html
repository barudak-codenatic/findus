<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FindUS - Tambah Jasa</title>
  <link rel="icon" type="image/x-icon" href="/public/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/public/images/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/public/images/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,200,0,0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
</head>

<body class="font-sans">
  <!-- Flash Notification -->
  <div id="flash-notification" class="fixed top-4 right-4 z-[60] hidden">
    <div id="flash-content" class="px-6 py-4 rounded-lg shadow-lg border-l-4 max-w-sm">
      <div class="flex items-center gap-3">
        <span id="flash-icon" class="material-symbols-outlined flex-shrink-0"></span>
        <div class="flex-1">
          <p id="flash-message" class="font-medium"></p>
          <p id="flash-detail" class="text-sm opacity-90 mt-1 hidden"></p>
        </div>
        <button id="flash-close" class="material-symbols-outlined text-lg opacity-70 hover:opacity-100 flex-shrink-0">
          close
        </button>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <!-- Top Bar -->
    <div class="flex justify-center items-center w-full bg-[#272343] text-white p-2">
      <nav class="flex space-x-2 md:space-x-4 items-center text-xs font-light">
        <a href="" class="flex items-center gap-1">
          <span class="material-symbols-outlined !text-sm md:!text-lg">expand_more</span>
          <span class="sm:inline">Eng</span>
        </a>
        <a href="" class="sm:inline">Faqs</a>
        <a href="" class="flex items-center gap-1">
          <span class="material-symbols-outlined !text-sm md:!text-lg">error</span>
          <span class="sm:inline">Need Help</span>
        </a>
      </nav>
    </div>

    <!-- Main Header -->
    <div class="bg-gray-100">
      <div
        class="container mx-auto flex flex-col md:flex-row justify-between items-center w-full px-4 md:px-8 lg:px-16 xl:px-28 py-4 gap-4 md:gap-0">
        <!-- Logo -->
        <a class="brand flex-shrink-0" href="/dashboard-provider">
          <img src="/public/images/Logo.svg" alt="FindUs" class="h-8 md:h-10">
        </a>

        <!-- Search Bar -->
        <div class="relative w-full md:w-1/2 lg:w-1/3 order-3 md:order-2">
          <input type="text" id="service-search-input" placeholder="Cari layanan..."
            class="px-4 py-2 text-sm bg-white rounded focus:outline-none w-full border border-gray-300"
            autocomplete="off" />
          <div id="service-search-suggestion"
            class="absolute left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow z-50 hidden max-h-60 overflow-auto">
          </div>
          <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
            <span class="material-symbols-outlined text-base text-gray-400">search</span>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="flex flex-wrap md:flex-nowrap space-x-2 md:space-x-4 items-center text-xs order-2 md:order-3">
          <a class="bg-white rounded px-2 md:px-4 py-1 flex items-center gap-1 whitespace-nowrap"
            href="/provider/services">
            <span class="material-symbols-outlined !text-lg">inventory</span>
            <span class="sm:inline">Layanan</span>
          </a>
          <a class="bg-white rounded px-2 md:px-4 py-1 flex items-center gap-1 whitespace-nowrap"
            href="/provider/orders">
            <span class="material-symbols-outlined !text-lg">receipt_long</span>
            <span class="sm:inline">Pesanan</span>
          </a>
          <a class="bg-white rounded px-2 md:px-4 py-1 flex items-center gap-1 whitespace-nowrap" href="/provider/chat">
            <span class="material-symbols-outlined !text-lg">chat</span>
            <span class="sm:inline">Chat</span>
          </a>
          <a class="bg-white rounded px-2 md:px-4 py-1 flex items-center gap-1 whitespace-nowrap" href=""
            id="profile-link">
            <span class="material-symbols-outlined !text-lg">person</span>
          </a>
        </nav>
      </div>
    </div>

    <!-- Breadcrumb -->
    <div class="border-b-1 border-gray-300 bg-white">
      <div
        class="container mx-auto flex flex-row justify-between items-center w-full px-4 md:px-8 lg:px-16 xl:px-28 py-2 md:py-4 text-xs gap-2 sm:gap-0">
        <nav class="flex items-center space-x-2 text-gray-600" aria-label="Breadcrumb">
          <a href="/" class="hover:underline flex items-center gap-1">
            <span class="material-symbols-outlined !text-sm md:!text-base align-middle">home</span>
            <span class="hidden sm:inline">Beranda</span>
          </a>
          <span class="mx-1 text-gray-400">/</span>
          <span class="text-gray-500">Tambah Jasa</span>
        </nav>
        <div class="contact flex items-center gap-1 md:gap-2 text-gray-500">
          <span class="hidden sm:inline">Contact:</span>
          <div class="md:hidden"><span class="material-symbols-outlined !text-base">phone</span></div>
          <span class="xs:inline">(0812) 1284-8626</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 md:px-6 lg:px-8 py-4 md:py-8 mb-24">
    <section class="max-w-7xl mx-auto">
      <!-- Header Section -->
      <div class="mb-6 md:mb-8">
        <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">
          Form Tambah Jasa Layanan
        </h2>
        <hr class="mt-4 md:mt-6 border-gray-300" />
      </div>

      <!-- Form -->
      <form id="add-service-form" class="space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-lg shadow-sm"
        enctype="multipart/form-data">
        <!-- Nama Jasa -->
        <div>
          <label for="service-name" class="block text-sm font-medium text-gray-700 mb-2">
            Nama Jasa <span class="text-red-500">*</span>
          </label>
          <input type="text" id="service-name" placeholder="Contoh: Jasa Sedot WC, Cuci Sepeda Motor, dll"
            class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition"
            required />
        </div>

        <!-- Kategori Jasa -->
        <div>
          <label for="service-category" class="block text-sm font-medium text-gray-700 mb-2">
            Kategori Jasa <span class="text-red-500">*</span>
          </label>
          <select id="service-category"
            class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition"
            required>
            <option value="" disabled selected>Pilih Kategori</option>
            <option value="Kebersihan">Kebersihan</option>
            <option value="Angkut Barang">Angkut Barang</option>
            <option value="Perbaikan">Perbaikan</option>
          </select>
        </div>

        <!-- Deskripsi -->
        <div>
          <label for="service-description" class="block text-sm font-medium text-gray-700 mb-2">
            Deskripsi <span class="text-red-500">*</span>
          </label>
          <textarea id="service-description" rows="4" md:rows="5"
            placeholder="Jelaskan detail layanan yang Anda tawarkan, termasuk cara kerja, durasi, dan hal-hal yang perlu diketahui customer..."
            class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition resize-none"
            required></textarea>
        </div>

        <!-- Harga -->
        <div>
          <label for="service-price" class="block text-sm font-medium text-gray-700 mb-2">
            Harga <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <span class="absolute left-4 top-3 text-gray-500">Rp</span>
            <input type="number" id="service-price" placeholder="0" min="0"
              class="w-full bg-gray-100 pl-12 pr-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition"
              required />
          </div>
          <p class="text-xs text-gray-500 mt-1">
            Masukkan harga dalam Rupiah tanpa titik atau koma
          </p>
        </div>

        <!-- Upload Gambar -->
        <div>
          <label for="service-image" class="block text-sm font-medium text-gray-700 mb-2">
            Gambar Jasa
          </label>
          <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 md:p-6">
            <input type="file" id="service-image" accept="image/*" class="hidden" />
            <label for="service-image" class="cursor-pointer flex flex-col items-center justify-center">
              <span class="material-symbols-outlined text-3xl md:text-4xl text-gray-400 mb-2">cloud_upload</span>
              <span class="text-sm text-gray-600 mb-1">Klik untuk upload gambar</span>
              <span class="text-xs text-gray-500">PNG, JPG hingga 5MB</span>
            </label>
          </div>
          <div id="image-preview" class="mt-4 hidden">
            <img id="preview-img" src="" alt="Preview"
              class="max-w-full md:max-w-xs h-32 md:h-48 object-cover rounded-lg border mx-auto md:mx-0" />
            <button type="button" id="remove-image"
              class="mt-2 text-sm text-red-600 hover:text-red-800 block mx-auto md:mx-0">
              Hapus gambar
            </button>
          </div>
        </div>

        <!-- Lokasi Jasa -->
        <div class="space-y-4">
          <h3 class="text-sm font-medium text-gray-700">Lokasi Jasa</h3>

          <!-- Provinsi & Kabupaten/Kota -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="province" class="block text-sm font-medium text-gray-700 mb-2">
                Provinsi <span class="text-red-500">*</span>
              </label>
              <select id="province"
                class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition"
                required>
                <option value="">Pilih Provinsi</option>
              </select>
            </div>

            <div>
              <label for="regency" class="block text-sm font-medium text-gray-700 mb-2">
                Kabupaten/Kota <span class="text-red-500">*</span>
              </label>
              <select id="regency"
                class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition"
                required disabled>
                <option value="">Pilih Kabupaten/Kota</option>
              </select>
            </div>
          </div>

          <!-- Kecamatan -->
          <div>
            <label for="district" class="block text-sm font-medium text-gray-700 mb-2">
              Kecamatan <span class="text-red-500">*</span>
            </label>
            <select id="district"
              class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition"
              required disabled>
              <option value="">Pilih Kecamatan</option>
            </select>
          </div>
        </div>

        <!-- Detail Alamat -->
        <div>
          <label for="service-address" class="block text-sm font-medium text-gray-700 mb-2">
            Detail Alamat <span class="text-red-500">*</span>
          </label>
          <textarea id="service-address" rows="3"
            placeholder="Masukkan detail alamat lengkap (nama jalan, nomor, RT/RW, kode pos)..."
            class="w-full bg-gray-100 px-4 py-3 border border-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#029FAE] focus:border-transparent transition resize-none"
            required></textarea>
          <p class="text-xs text-gray-500 mt-1">
            Tuliskan alamat lengkap agar customer dapat menemukan lokasi Anda dengan mudah
          </p>
        </div>

        <!-- Tombol Submit -->
        <div class="pt-4 md:pt-6 border-t border-gray-200">
          <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
            <button type="button" onclick="history.back()"
              class="w-full sm:flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
              Batal
            </button>
            <button type="submit"
              class="w-full sm:flex-1 bg-[#029FAE] text-white py-3 rounded-lg font-medium hover:bg-[#027f8a] transition flex items-center justify-center gap-2"
              id="submit-btn">
              <span class="material-symbols-outlined">add</span>
              Tambah Jasa Layanan
            </button>
          </div>
        </div>
      </form>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-200 py-6 md:py-10 text-sm text-gray-700">
    <div class="container mx-auto px-4 md:px-8 lg:px-16 xl:px-28 py-4">
      <!-- Desktop Footer -->
      <div class="hidden md:flex justify-start w-full gap-12 lg:gap-24">
        <div class="w-1/4 flex flex-col gap-4">
          <a class="brand" href="/"><img src="/public/images/Logo.svg" alt="FindUs" class="h-8"></a>
          <p class="text-sm">Platform online untuk mahasiswa yang kos! Belanja kebutuhan harian, perlengkapan kamar,
            serta pesan layanan seperti jasa layanan, bersih-bersih, dan lainnya dengan mudah.</p>
          <div class="flex gap-3">
            <a href="#" class="text-xl px-1 hover:text-[#029FAE] transition"><i class="bi bi-facebook"></i></a>
            <a href="#" class="text-xl px-1 hover:text-[#029FAE] transition"><i class="bi bi-instagram"></i></a>
            <a href="#" class="text-xl px-1 hover:text-[#029FAE] transition"><i class="bi bi-twitter"></i></a>
          </div>
        </div>

        <div>
          <h5 class="font-medium mb-2 text-gray-400">Category</h5>
          <ul class="space-y-1">
            <li><a href="#" class="hover:underline hover:text-[#029FAE]">Kebersihan</a></li>
            <li><a href="#" class="hover:underline hover:text-[#029FAE]">Angkut Barang</a></li>
            <li><a href="#" class="hover:underline hover:text-[#029FAE]">Perbaikan</a></li>
          </ul>
        </div>

        <div>
          <h5 class="font-medium mb-2 text-gray-400">Support</h5>
          <ul class="space-y-1">
            <li><a href="#" class="hover:underline">Cara Pemesanan</a></li>
            <li><a href="#" class="hover:underline">Syarat & Ketentuan</a></li>
            <li><a href="#" class="hover:underline">Kebijakan Privasi</a></li>
            <li><a href="#" class="hover:underline">Hubungi Kami</a></li>
          </ul>
        </div>
      </div>

      <!-- Mobile Footer -->
      <div class="md:hidden space-y-6">
        <div class="text-center">
          <a class="brand" href="/"><img src="/public/images/Logo.svg" alt="FindUs" class="h-8 mx-auto mb-4"></a>
          <p class="text-sm">Platform online untuk mahasiswa yang kos!</p>
        </div>

        <div class="grid grid-cols-2 gap-6">
          <div>
            <h5 class="font-medium mb-2 text-gray-400">Category</h5>
            <ul class="space-y-1">
              <li><a href="#" class="hover:underline hover:text-[#029FAE] text-sm">Kebersihan</a></li>
              <li><a href="#" class="hover:underline hover:text-[#029FAE] text-sm">Angkut Barang</a></li>
              <li><a href="#" class="hover:underline hover:text-[#029FAE] text-sm">Perbaikan</a></li>
            </ul>
          </div>

          <div>
            <h5 class="font-medium mb-2 text-gray-400">Support</h5>
            <ul class="space-y-1">
              <li><a href="#" class="hover:underline text-sm">Cara Pemesanan</a></li>
              <li><a href="#" class="hover:underline text-sm">Syarat & Ketentuan</a></li>
              <li><a href="#" class="hover:underline text-sm">Kebijakan Privasi</a></li>
              <li><a href="#" class="hover:underline text-sm">Hubungi Kami</a></li>
            </ul>
          </div>
        </div>

        <div class="flex justify-center gap-4">
          <a href="#" class="text-xl hover:text-[#029FAE] transition"><i class="bi bi-facebook"></i></a>
          <a href="#" class="text-xl hover:text-[#029FAE] transition"><i class="bi bi-instagram"></i></a>
          <a href="#" class="text-xl hover:text-[#029FAE] transition"><i class="bi bi-twitter"></i></a>
        </div>
      </div>

      <!-- Copyright -->
      <div class="mt-6 md:mt-8 border-t border-gray-200 pt-4 text-center text-xs text-gray-500">
        &copy; 2025 - FindUS • Designed & Developed by epaarito
      </div>
    </div>
  </footer>

  <!-- Custom Alert Modal -->
  <div id="custom-alert-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
      <div class="flex items-center mb-4">
        <span id="alert-icon" class="material-symbols-outlined text-2xl mr-3"></span>
        <h3 id="alert-title" class="text-lg font-semibold"></h3>
      </div>
      <p id="alert-message" class="text-gray-600 mb-6"></p>
      <div class="flex justify-end">
        <button id="alert-ok-button"
          class="px-6 py-2 bg-[#029FAE] text-white rounded-lg hover:bg-[#027f8a] transition-colors">
          OK
        </button>
      </div>
    </div>
  </div>

  <!-- Custom Confirm Modal -->
  <div id="custom-confirm-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
      <div class="flex items-center mb-4">
        <span class="material-symbols-outlined text-2xl mr-3 text-orange-500">warning</span>
        <h3 id="confirm-title" class="text-lg font-semibold">Konfirmasi</h3>
      </div>
      <p id="confirm-message" class="text-gray-600 mb-6"></p>
      <div class="flex justify-end space-x-3">
        <button id="confirm-cancel-button"
          class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors">
          Batal
        </button>
        <button id="confirm-ok-button"
          class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
          Konfirmasi
        </button>
      </div>
    </div>
  </div>

  <script>
    // === FLASH NOTIFICATION ===
    const flash = {
      notification: document.getElementById('flash-notification'),
      content: document.getElementById('flash-content'),
      icon: document.getElementById('flash-icon'),
      message: document.getElementById('flash-message'),
      detail: document.getElementById('flash-detail'),
      close: document.getElementById('flash-close'),
      show(msg, type = 'success', detail = '') {
        this.message.textContent = msg;
        if (detail) {
          this.detail.textContent = detail;
          this.detail.classList.remove('hidden');
        } else {
          this.detail.classList.add('hidden');
        }
        let iconName, bgClass;
        switch (type) {
          case 'success': iconName = 'check_circle'; bgClass = 'bg-green-50 text-green-800 border-green-500'; break;
          case 'error': iconName = 'error'; bgClass = 'bg-red-50 text-red-800 border-red-500'; break;
          case 'warning': iconName = 'warning'; bgClass = 'bg-yellow-50 text-yellow-800 border-yellow-500'; break;
          case 'info': iconName = 'info'; bgClass = 'bg-blue-50 text-blue-800 border-blue-500'; break;
          default: iconName = 'notifications'; bgClass = 'bg-gray-50 text-gray-800 border-gray-500';
        }
        this.icon.textContent = iconName;
        this.content.className = `px-6 py-4 rounded-lg shadow-lg border-l-4 max-w-sm ${bgClass}`;
        this.notification.classList.remove('hidden');
        setTimeout(() => this.hide(), 5000);
      },
      hide() { this.notification.classList.add('hidden'); }
    };
    flash.close.addEventListener('click', () => flash.hide());

    // Load user authentication
    fetch("/api/auth/me")
      .then((res) => res.json())
      .then((data) => {
        if (!data.user || data.user.role !== "PROVIDER") {
          flash.show("Akses ditolak. Silakan login sebagai PROVIDER.", "error");
          setTimeout(() => { window.location.href = "/login"; }, 2000);
        } else {
          const profileLink = document.getElementById("profile-link");
          if (profileLink) {
            profileLink.innerHTML = `
              <div class="relative cursor-pointer select-none" id="profile-dropdown-parent">
                <span class="flex items-center gap-1" id="profile-dropdown-toggle">
                  <span class="material-symbols-outlined !text-lg">person</span>
                  <span class="hidden sm:inline">${data.user.name}</span>
                  <span class="material-symbols-outlined !text-lg hidden sm:inline">expand_more</span>
                </span>
                <div id="profile-dropdown-menu" class="hidden absolute right-0 mt-2 w-40 bg-white rounded shadow-lg z-50 shadow-md text-gray-700">
                  <a href="/profile" class="block px-4 py-2 hover:bg-gray-100">Profile</a>
                  <a href="/api/auth/logout" class="block px-4 py-2 hover:bg-gray-100">Logout</a>
                </div>
              </div>
            `;
            profileLink.href = "javascript:void(0)";

            const toggle = document.getElementById("profile-dropdown-toggle");
            const menu = document.getElementById("profile-dropdown-menu");
            document.addEventListener("click", function (e) {
              if (toggle && menu) {
                if (toggle.contains(e.target)) {
                  menu.classList.toggle("hidden");
                } else if (!menu.contains(e.target)) {
                  menu.classList.add("hidden");
                }
              }
            });
          }
        }
      })
      .catch((err) => {
        console.error("Gagal memuat data user:", err);
        window.location.href = "/login";
      });

    // Image preview functionality
    const imageInput = document.getElementById("service-image");
    const imagePreview = document.getElementById("image-preview");
    const previewImg = document.getElementById("preview-img");
    const removeImageBtn = document.getElementById("remove-image");

    imageInput.addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result;
          imagePreview.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    });

    removeImageBtn.addEventListener("click", function () {
      imageInput.value = "";
      imagePreview.classList.add("hidden");
      previewImg.src = "";
    });

    // Custom Alert and Confirm Functions
    function showAlert(message, type = "info", title = "") {
      const modal = document.getElementById("custom-alert-modal");
      const icon = document.getElementById("alert-icon");
      const titleEl = document.getElementById("alert-title");
      const messageEl = document.getElementById("alert-message");
      const okButton = document.getElementById("alert-ok-button");

      // Set icon and title based on type
      switch (type) {
        case "success":
          icon.textContent = "check_circle";
          icon.className = "material-symbols-outlined text-2xl mr-3 text-green-500";
          titleEl.textContent = title || "Berhasil";
          okButton.className = "px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors";
          break;
        case "error":
          icon.textContent = "error";
          icon.className = "material-symbols-outlined text-2xl mr-3 text-red-500";
          titleEl.textContent = title || "Error";
          okButton.className = "px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors";
          break;
        case "warning":
          icon.textContent = "warning";
          icon.className = "material-symbols-outlined text-2xl mr-3 text-orange-500";
          titleEl.textContent = title || "Peringatan";
          okButton.className = "px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors";
          break;
        default:
          icon.textContent = "info";
          icon.className = "material-symbols-outlined text-2xl mr-3 text-blue-500";
          titleEl.textContent = title || "Informasi";
          okButton.className = "px-6 py-2 bg-[#029FAE] text-white rounded-lg hover:bg-[#027f8a] transition-colors";
      }

      messageEl.textContent = message;
      modal.classList.remove("hidden");

      return new Promise((resolve) => {
        const handleOk = () => {
          modal.classList.add("hidden");
          okButton.removeEventListener("click", handleOk);
          resolve(true);
        };
        okButton.addEventListener("click", handleOk);
      });
    }

    function showConfirm(message, title = "Konfirmasi") {
      const modal = document.getElementById("custom-confirm-modal");
      const titleEl = document.getElementById("confirm-title");
      const messageEl = document.getElementById("confirm-message");
      const cancelButton = document.getElementById("confirm-cancel-button");
      const okButton = document.getElementById("confirm-ok-button");

      titleEl.textContent = title;
      messageEl.textContent = message;
      modal.classList.remove("hidden");

      return new Promise((resolve) => {
        const handleCancel = () => {
          modal.classList.add("hidden");
          cleanup();
          resolve(false);
        };

        const handleOk = () => {
          modal.classList.add("hidden");
          cleanup();
          resolve(true);
        };

        const cleanup = () => {
          cancelButton.removeEventListener("click", handleCancel);
          okButton.removeEventListener("click", handleOk);
        };

        cancelButton.addEventListener("click", handleCancel);
        okButton.addEventListener("click", handleOk);
      });
    }

    // Form submission
    document.getElementById("add-service-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const submitBtn = document.getElementById("submit-btn");
      const originalText = submitBtn.innerHTML;

      // Show loading state
      submitBtn.innerHTML = `
        <span class="material-symbols-outlined animate-spin">refresh</span>
        Menyimpan...
      `;
      submitBtn.disabled = true;

      try {
        // Gunakan FormData untuk menangani upload file
        const formData = new FormData();
        formData.append("name", document.getElementById("service-name").value);
        formData.append("description", document.getElementById("service-description").value);
        formData.append("price", document.getElementById("service-price").value);

        // Tambahkan kategori
        formData.append("category", document.getElementById("service-category").value);

        // Tambahkan data lokasi
        const provinceSelect = document.getElementById("province");
        const regencySelect = document.getElementById("regency");
        const districtSelect = document.getElementById("district");

        if (provinceSelect.value) {
          formData.append("province_id", provinceSelect.value);
          formData.append("province_name", provinceSelect.options[provinceSelect.selectedIndex].text);
        }

        if (regencySelect.value) {
          formData.append("regency_id", regencySelect.value);
          formData.append("regency_name", regencySelect.options[regencySelect.selectedIndex].text);
        }

        if (districtSelect.value) {
          formData.append("district_id", districtSelect.value);
          formData.append("district_name", districtSelect.options[districtSelect.selectedIndex].text);
        }

        // Tambahkan detail alamat
        formData.append("address", document.getElementById("service-address").value);

        // Tambahkan file gambar jika ada
        const imageInput = document.getElementById("service-image");
        if (imageInput.files && imageInput.files[0]) {
          formData.append("image", imageInput.files[0]);
        }

        const response = await fetch("/api/services", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();

        if (data.success) {
          // Show success state
          submitBtn.innerHTML = `
            <span class="material-symbols-outlined">check</span>
            Berhasil!
          `;
          submitBtn.classList.remove("bg-[#029FAE]", "hover:bg-[#027f8a]");
          submitBtn.classList.add("bg-green-500");

          await showAlert("Jasa layanan berhasil ditambahkan!", "success");
          setTimeout(() => {
            window.location.href = "/dashboard-provider";
          }, 1000);
        } else {
          throw new Error(data.error || "Gagal menyimpan jasa");
        }
      } catch (error) {
        console.error("Error saving service:", error);

        // Show error state
        submitBtn.innerHTML = `
          <span class="material-symbols-outlined">error</span>
          Gagal menyimpan
        `;
        submitBtn.classList.remove("bg-[#029FAE]", "hover:bg-[#027f8a]");
        submitBtn.classList.add("bg-red-500");

        await showAlert(
          error.message || "Terjadi kesalahan saat menyimpan jasa layanan",
          "error"
        );

        // Reset button after 3 seconds
        setTimeout(() => {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
          submitBtn.classList.remove("bg-red-500");
          submitBtn.classList.add("bg-[#029FAE]", "hover:bg-[#027f8a]");
        }, 3000);
      }
    });

    // Format price input
    document.getElementById("service-price").addEventListener("input", function (e) {
      // Remove any non-digit characters except for backspace/delete
      let value = e.target.value.replace(/[^\d]/g, "");
      e.target.value = value;
    });

    // Load location data
    const provinceSelect = document.getElementById("province");
    const regencySelect = document.getElementById("regency");
    const districtSelect = document.getElementById("district");

    // Load provinces
    async function loadProvinces() {
      try {
        const response = await fetch("/public/data/provinces.json");
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const provinces = await response.json();

        // Sort provinces by name
        provinces.sort((a, b) => a.name.localeCompare(b.name));

        // Add options to select
        provinces.forEach((province) => {
          const option = document.createElement("option");
          option.value = province.id;
          option.textContent = province.name;
          provinceSelect.appendChild(option);
        });
      } catch (error) {
        console.error("Error loading provinces:", error);
        await showAlert("Gagal memuat data provinsi. Silakan refresh halaman.", "error");
      }
    }

    // Load regencies based on selected province
    async function loadRegencies(provinceId) {
      try {
        // Clear previous options
        regencySelect.innerHTML = '<option value="">Pilih Kabupaten/Kota</option>';
        districtSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';

        // Disable selects
        districtSelect.disabled = true;

        if (!provinceId) {
          regencySelect.disabled = true;
          return;
        }

        const response = await fetch("/public/data/regencies.json");
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const regencies = await response.json();

        // Filter regencies by province_id and sort by name
        const filteredRegencies = regencies
          .filter((regency) => regency.province_id === provinceId)
          .sort((a, b) => a.name.localeCompare(b.name));

        // Add options to select
        filteredRegencies.forEach((regency) => {
          const option = document.createElement("option");
          option.value = regency.id;
          option.textContent = regency.name;
          regencySelect.appendChild(option);
        });

        // Enable select
        regencySelect.disabled = false;
      } catch (error) {
        console.error("Error loading regencies:", error);
        await showAlert("Gagal memuat data kabupaten/kota. Silakan coba lagi.", "error");
      }
    }

    // Load districts based on selected regency
    async function loadDistricts(regencyId) {
      try {
        // Clear previous options
        districtSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';

        if (!regencyId) {
          districtSelect.disabled = true;
          return;
        }

        const response = await fetch("/public/data/districts.json");
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const districts = await response.json();

        // Filter districts by regency_id and sort by name
        const filteredDistricts = districts
          .filter((district) => district.regency_id === regencyId)
          .sort((a, b) => a.name.localeCompare(b.name));

        // Add options to select
        filteredDistricts.forEach((district) => {
          const option = document.createElement("option");
          option.value = district.id;
          option.textContent = district.name;
          districtSelect.appendChild(option);
        });

        // Enable select
        districtSelect.disabled = false;
      } catch (error) {
        console.error("Error loading districts:", error);
        await showAlert("Gagal memuat data kecamatan. Silakan coba lagi.", "error");
      }
    }

    // Event listeners for select changes
    provinceSelect.addEventListener("change", function () {
      loadRegencies(this.value);
    });

    regencySelect.addEventListener("change", function () {
      loadDistricts(this.value);
    });

    // Load provinces on page load
    loadProvinces();

    // === SEARCH SUGGESTION ===
    const searchInput = document.getElementById("service-search-input");
    const searchSuggestion = document.getElementById("service-search-suggestion");

    let allServices = [];
    let allProvinces = [];
    let allRegencies = [];

    // Ambil semua data untuk suggestion
    Promise.all([
      fetch("/api/services").then((res) => res.json()),
      fetch("/public/data/provinces.json").then((res) => res.json()),
      fetch("/public/data/regencies.json").then((res) => res.json()),
    ]).then(([servicesData, provincesData, regenciesData]) => {
      allServices = servicesData.services || [];
      allProvinces = provincesData || [];
      allRegencies = regenciesData || [];
    });

    // Tampilkan suggestion saat mengetik
    searchInput.addEventListener("input", function () {
      const keyword = this.value.trim().toLowerCase();
      if (!keyword) {
        searchSuggestion.classList.add("hidden");
        searchSuggestion.innerHTML = "";
        return;
      }

      // Filter services berdasarkan nama/deskripsi
      const filteredServices = allServices
        .filter(
          (s) =>
            s.name.toLowerCase().includes(keyword) ||
            (s.description && s.description.toLowerCase().includes(keyword))
        )
        .slice(0, 5);

      // Filter provinsi berdasarkan nama
      const filteredProvinces = allProvinces
        .filter((p) => p.name.toLowerCase().includes(keyword))
        .slice(0, 3);

      // Filter kota/kabupaten berdasarkan nama
      const filteredRegencies = allRegencies
        .filter((r) => r.name.toLowerCase().includes(keyword))
        .slice(0, 3);

      let suggestionHTML = "";

      // Tambahkan suggestion services
      if (filteredServices.length > 0) {
        suggestionHTML += `<div class="px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50">LAYANAN</div>`;
        filteredServices.forEach((s) => {
          suggestionHTML += `<div class="px-4 py-2 hover:bg-[#029FAE] hover:text-white cursor-pointer flex items-center gap-1" data-type="service" data-id="${s.id}">
            <span class="material-symbols-outlined text-sm">work</span>${s.name}
          </div>`;
        });
      }

      // Tambahkan suggestion provinsi
      if (filteredProvinces.length > 0) {
        suggestionHTML += `<div class="px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50">PROVINSI</div>`;
        filteredProvinces.forEach((p) => {
          suggestionHTML += `<div class="px-4 py-2 hover:bg-[#029FAE] hover:text-white cursor-pointer flex items-center gap-1" data-type="province" data-id="${p.id}" data-name="${p.name}">
            <span class="material-symbols-outlined text-sm">location_on</span>${p.name}
          </div>`;
        });
      }

      // Tambahkan suggestion kota/kabupaten
      if (filteredRegencies.length > 0) {
        suggestionHTML += `<div class="px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50">KOTA/KABUPATEN</div>`;
        filteredRegencies.forEach((r) => {
          const province = allProvinces.find((p) => p.id === r.province_id);
          suggestionHTML += `<div class="px-4 py-2 hover:bg-[#029FAE] hover:text-white cursor-pointer flex items-center gap-1" data-type="regency" data-id="${r.id}" data-name="${r.name}" data-province-id="${r.province_id}">
            <span class="material-symbols-outlined text-sm">place</span>${r.name}, ${province?.name || ""}
          </div>`;
        });
      }

      if (suggestionHTML === "") {
        searchSuggestion.innerHTML = `<div class="px-4 py-2 text-gray-400">Tidak ditemukan</div>`;
      } else {
        searchSuggestion.innerHTML = suggestionHTML;
      }

      searchSuggestion.classList.remove("hidden");
    });

    // Klik suggestion: redirect berdasarkan tipe
    searchSuggestion.addEventListener("click", function (e) {
      const item = e.target.closest("[data-type]");
      if (item) {
        const type = item.dataset.type;
        const id = item.dataset.id;
        const name = item.dataset.name;

        if (type === "service") {
          const serviceName = item.textContent.trim().replace(/^work/, "");
          window.location.href = `/provider/services?search=${encodeURIComponent(serviceName)}`;
        } else if (type === "province") {
          window.location.href = `/provider/services?province_id=${id}&search=${encodeURIComponent(name)}`;
        } else if (type === "regency") {
          const provinceId = item.dataset.provinceId;
          window.location.href = `/provider/services?province_id=${provinceId}&regency_id=${id}&search=${encodeURIComponent(name)}`;
        }
      }
    });

    // Sembunyikan suggestion jika klik di luar
    document.addEventListener("click", function (e) {
      if (!searchInput.contains(e.target) && !searchSuggestion.contains(e.target)) {
        searchSuggestion.classList.add("hidden");
      }
    });

    // Submit search: cek apakah provinsi/kota atau layanan
    searchInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        const keyword = this.value.trim();
        if (!keyword) {
          window.location.href = "/provider/services";
          return;
        }

        // Cek apakah keyword cocok dengan provinsi
        const matchedProvince = allProvinces.find(
          (p) => p.name.toLowerCase() === keyword.toLowerCase()
        );
        if (matchedProvince) {
          window.location.href = `/provider/services?province_id=${matchedProvince.id}&search=${encodeURIComponent(matchedProvince.name)}`;
          return;
        }

        // Cek apakah keyword cocok dengan kota/kabupaten
        const matchedRegency = allRegencies.find(
          (r) => r.name.toLowerCase() === keyword.toLowerCase()
        );
        if (matchedRegency) {
          window.location.href = `/provider/services?province_id=${matchedRegency.province_id}&regency_id=${matchedRegency.id}&search=${encodeURIComponent(matchedRegency.name)}`;
          return;
        }

        // Jika tidak cocok dengan lokasi, search sebagai layanan
        window.location.href = `/provider/services?search=${encodeURIComponent(keyword)}`;
      }
    });
  </script>
</body>

</html>